<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Whisper Simple Chat</title>

<style>
body{font-family:sans-serif;margin:0;background:#f4f4f4;padding:20px}
#login,#chat{
  max-width:400px;margin:auto;background:#fff;padding:20px;
  border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1)
}
#chat{display:none}
input,button{
  width:100%;padding:12px;margin-top:10px;font-size:16px;border-radius:6px
}
button{background:#008069;color:#fff;border:none;font-weight:bold}
#messages{
  height:300px;overflow:auto;border:1px solid #ddd;padding:10px;margin-top:10px;
  background:#fafafa;border-radius:6px
}
.msg-me{text-align:right;color:#008069;margin:6px;font-weight:600}
.msg-other{text-align:left;color:#444;margin:6px;font-weight:600}
</style>

</head>
<body>

<div id="login">
  <h3>Whisper â€” Enter PIN</h3>
  <input id="pin" placeholder="Enter 8-digit PIN">
  <button onclick="startChat()">Start Chat</button>
</div>

<div id="chat">
  <h3>Whisper Chat</h3>
  <div id="messages"></div>
  <input id="msg" placeholder="Type message...">
  <button onclick="sendMsg()">Send</button>
</div>

<script>
let PIN="";
let timer=null;

// PUBLIC STORAGE API (free)
const API="https://jsonbin.org/ds-whisper/";

async function startChat(){
  PIN=document.getElementById("pin").value.trim();
  if(PIN.length!==8 || !/^\d+$/.test(PIN)){
    alert("Enter 8 digit PIN"); return;
  }

  document.getElementById("login").style.display="none";
  document.getElementById("chat").style.display="block";

  loadMessages();
  timer=setInterval(loadMessages,1200);
}

async function loadMessages(){
  try{
    let r=await fetch(API+PIN);
    if(!r.ok) return;
    let data=await r.json();

    let box=document.getElementById("messages");
    box.innerHTML="";

    (data||[]).forEach(m=>{
      let d=document.createElement("div");
      d.className="msg-"+(m.me?"me":"other");
      d.textContent=m.text;
      box.appendChild(d);
    });

    box.scrollTop=box.scrollHeight;
  }catch(e){}
}

async function sendMsg(){
  let txt=document.getElementById("msg").value.trim();
  if(!txt) return;

  let r=await fetch(API+PIN);
  let old=[];
  if(r.ok){
    old=await r.json();
  }

  old.push({text:txt,me:true});

  await fetch(API+PIN,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(old)
  });

  document.getElementById("msg").value="";
  loadMessages();
}
</script>
</body>
</html>
